steps:
- name: 'gcr.io/cloud-builders/git'
  args: ['clone', 'https://github.com/GrigorievNick/docker']
- name: 'gcr.io/cloud-builders/docker'
  args: ["build", "-t", "gcr.io/$PROJECT_ID/jenkins:$REVISION_ID", "-f", "Dockerfile-alpine", "."]
- name: 'gcr.io/cloud-builders/docker'
  args: ["push", "gcr.io/$PROJECT_ID/jenkins:$REVISION_ID"]
- name: 'gcr.io/cloud-builders/gcloud'
  args:
  - 'beta'
  - 'compute'
  - 'create-with-container'
  - 'jenkins-vm'
  - '--container-image'
  - 'gcr.io/$PROJECT_ID/jenkins:$REVISION_ID'
  - '--tags'
  - 'jenkins-network'
#- name: 'gcr.io/cloud-builders/gcloud'
#  args:
#  - 'compute'
#  - 'firewall-rules'
#  - 'create'
#  - 'allow-jenkins-8080'
#  - '—direction=INGRESS'
#  - '—priority=1000'
#  - '—network=default'
#  - '—action=ALLOW'
#  - '--rules tcp:8080'
#  - '--targets-tags jenkins'

logsBucket: 'gs://jenkins_build_logs'
